---
description: 创建具有分阶段方法和章程合规检查的实施计划。
handoffs:
  - label: 生成任务
    agent: speckit.tasks
    prompt: 将此计划分解为可执行任务
  - label: 开始实施
    agent: speckit.implement
    prompt: 开始实施此计划的阶段 1
---

## 用户输入

```text
{user_input}
```

您**必须**在继续之前考虑用户输入（如果非空）。

## 大纲

您正在使用 `.specify/templates/plan-template.md` 的模板创建实施计划。该计划必须详细说明如何在遵守章程原则的同时构建功能。

遵循此执行流程：

1. **加载输入：**
   - 章程来自 `.specify/memory/constitution.md`
   - 规格说明文件（如果用户引用或在 `.specify/specs/` 中找到）
   - 计划模板来自 `.specify/templates/plan-template.md`

2. **章程检查（第一步）：**
   - 审查章程中的所有 9 项原则
   - 识别哪些原则适用于此功能
   - 为计划准备检查清单（使用模板的章程检查部分）

3. **定义技术方法：**
   - 架构：组件交互、数据流、状态管理
   - 关键设计决策及其理由和考虑的替代方案
   - 对于每个决策，引用支持的章程原则

4. **分解为阶段：**
   - 阶段 1：基础（模型、类型、基本结构）
   - 阶段 2：核心逻辑（业务规则、验证）
   - 阶段 3：集成（API 端点、前端、测试）
   - 每个阶段：目标、任务、成功标准、工作量估算

5. **定义 API 契约：**
   - 显示 Pydantic 模型（snake_case）
   - 显示 JSON 格式（通过 alias_generator 的 camelCase）
   - 包括错误响应（400、500）
   - 引用原则 3（Pydantic）和原则 4（camelCase）

6. **数据库变更：**
   - SQLite 模式更新（如适用）
   - 迁移策略
   - 引用原则 8（元数据缓存）（如相关）

7. **测试策略：**
   - 单元测试（Pydantic 验证、SQL 解析）
   - 集成测试（API 契约、DB 交互）
   - 手动测试清单（类型检查、camelCase 响应、CORS）
   - 引用原则 2（类型标注）和原则 7（SQL 安全）

8. **风险评估：**
   - 识别潜在阻碍
   - 缓解策略
   - 应对每个风险的章程原则

9. **验证：**
   - 章程检查清单完成
   - 所有阶段都有工作量估算
   - API 契约显示 Python 和 JSON 格式
   - 测试涵盖章程合规性（类型、SQL 安全、camelCase）

10. **写入计划** 到：
    - 建议路径：`.specify/plans/[功能名称]-plan.md`
    - 或用户指定的路径

11. **输出摘要：**
    - 计划位置
    - 总估算工作量（所有阶段之和）
    - 关键路径项目
    - 与此计划最相关的章程原则
    - 建议的下一步（生成任务或开始实施）
    - 提交消息建议

## 格式要求

- 对风险评估使用表格
- 对章程检查和测试使用清单
- 对模式和模型使用代码块
- 清楚地标记阶段和任务

如果未提供规格说明，从用户输入推断需求，并针对模糊区域提出澄清问题。在"关键设计决策"部分记录假设。

确保计划是可执行的：任务应该足够具体以估算工作量和分配。
