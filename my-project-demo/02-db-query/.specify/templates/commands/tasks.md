---
description: 生成按章程原则组织的可执行任务列表，以实现系统化实施。
handoffs:
  - label: 开始实施
    agent: speckit.implement
    prompt: 开始处理此列表中的任务
  - label: 审查进度
    agent: speckit.review
    prompt: 审查已完成的任务并更新状态
---

## 用户输入

```text
{user_input}
```

您**必须**在继续之前考虑用户输入（如果非空）。

## 大纲

您正在使用 `.specify/templates/tasks-template.md` 的模板创建任务列表。任务必须按章程原则组织，以确保系统化合规。

遵循此执行流程：

1. **加载输入：**
   - 章程来自 `.specify/memory/constitution.md`
   - 实施计划（如果存在于 `.specify/plans/`）
   - 规格说明文件（如果存在于 `.specify/specs/`）
   - 任务模板来自 `.specify/templates/tasks-template.md`

2. **提取需求：**
   - 从计划：阶段、API 契约、数据库变更、测试策略
   - 从规格说明：功能需求、非功能需求、验收标准
   - 从用户输入：额外的上下文或请求的特定任务

3. **按章程原则组织：**
   - 对于 9 项原则中的每一项，创建任务部分
   - **原则 1：** 代码风格设置的任务（mypy、TypeScript 严格模式）
   - **原则 2：** 添加类型标注的任务
   - **原则 3：** 创建 Pydantic 模型的任务
   - **原则 4：** camelCase 配置和验证的任务
   - **原则 5：** 记录无身份验证设计的任务
   - **原则 6：** CORS 设置的任务
   - **原则 7：** SQL 解析、验证、LIMIT 注入的任务
   - **原则 8：** SQLite 模式、元数据提取、缓存的任务
   - **原则 9：** 结构化响应模型的任务

4. **添加横切任务：**
   - 前端实施（按功能组织，而非原则）
   - 集成与测试（E2E、CI/CD）
   - 可观测性与文档（日志、README、快速入门）

5. **任务格式（每个任务）：**
   - 唯一 ID（TASK-XXX）
   - 描述（具体、可执行）
   - 负责人（或待定）
   - 工作量估算（小时）
   - 状态（未开始 | 进行中 | 已阻止 | 已完成）
   - 依赖（其他任务 ID）

6. **依赖关系：**
   - 识别先决任务（例如，TASK-003 依赖于 TASK-001）
   - 确保无循环依赖
   - 标记关键路径（阻止许多其他任务的任务）

7. **验证：**
   - 所有任务都是具体和可衡量的
   - 每个任务引用相关的章程原则
   - 工作量估算合理（通常 1-4 小时，标记 >8 小时进行分解）
   - 依赖关系明确
   - 任务总数与范围匹配（小功能：10-20，大功能：30-50）

8. **写入任务列表** 到：
   - 建议路径：`.specify/tasks/[功能名称]-tasks.md`
   - 或用户指定的路径

9. **输出摘要：**
   - 任务列表位置
   - 按状态的任务总数
   - 关键路径任务（阻止其他任务的前 5 个）
   - 估算的总工作量（所有任务之和）
   - 任务最多的章程原则（表示重点领域）
   - 建议的下一步（开始实施或审查计划）
   - 提交消息建议

## 任务分解指南

**好的任务（具体、可衡量）：**
- ✅ "在 query_validator.py 中使用 sqlglot.parse_one() 实现 SQL 解析"
- ✅ "为 ConnectionRequest 添加 Pydantic 模型，带 connection_string 字段验证"

**坏的任务（模糊、不可执行）：**
- ❌ "添加验证"
- ❌ "实现后端"
- ❌ "修复 bug"

**工作量估算：**
- 0.5-1 小时：配置更改、简单测试、文档更新
- 2-3 小时：单功能实施、带验证器的 Pydantic 模型
- 4+ 小时：复杂逻辑、集成工作、E2E 测试套件
- 8+ 小时：应分解为更小的任务

## 格式要求

- 对任务使用复选框
- 按原则或阶段分组
- 在末尾包含任务摘要表（状态计数）
- 对任务 ID 使用粗体（TASK-XXX）

如果未提供计划或规格说明，基于用户输入和章程原则创建最小任务列表。优先考虑原则 7（SQL 安全）和原则 8（元数据缓存），因为这些是数据库查询工具项目的核心。
